<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Bot Manager - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        :root {
            --primary: #5865F2;
            --primary-dark: #4752C4;
            --primary-light: #7983f5;
            --success: #57F287;
            --warning: #FEE75C;
            --danger: #ED4245;
            --dark-1: #0a0a0c;
            --dark-2: #1a1b1e;
            --dark-3: #2c2d31;
            --dark-4: #3a3b40;
            --text-primary: #ffffff;
            --text-secondary: #b5bac1;
            --border: #2c2f33;
        }

        body {
            background: var(--dark-1);
            color: var(--text-primary);
            min-height: 100vh;
            font-size: 14px;
        }

        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--dark-1) 0%, #000000 100%);
            position: relative;
        }

        .login-box {
            background: var(--dark-2);
            padding: 40px;
            border-radius: 20px;
            width: 450px;
            border: 1px solid var(--border);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo h1 {
            font-size: 32px;
            background: linear-gradient(135deg, var(--primary), #9b87f5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .input-group input, .input-group select {
            background: var(--dark-3);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(88, 101, 242, 0.2);
        }

        .login-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .login-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .secondary-btn {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .secondary-btn:hover {
            background: var(--dark-3);
            color: var(--text-primary);
        }

        .discord-btn {
            background: #5865F2;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .code-display {
            background: var(--dark-3);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            letter-spacing: 8px;
            color: var(--primary);
            border: 2px dashed var(--primary);
            margin: 20px 0;
        }

        .timer {
            font-size: 14px;
            color: var(--text-secondary);
            text-align: center;
        }

        .timer.warning {
            color: var(--warning);
        }

        /* Dashboard Layout */
        .dashboard {
            display: none;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: var(--dark-2);
            border-right: 1px solid var(--border);
            position: fixed;
            width: 280px;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-header h2 {
            font-size: 20px;
            background: linear-gradient(135deg, var(--primary), #9b87f5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info-sidebar {
            padding: 20px 24px;
            background: var(--dark-3);
            margin: 16px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar-large {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .sidebar-menu {
            padding: 0 16px;
        }

        .menu-category {
            color: var(--text-secondary);
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            padding: 16px 12px 8px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 8px;
            margin-bottom: 2px;
        }

        .menu-item:hover {
            background: var(--dark-3);
            color: var(--text-primary);
        }

        .menu-item.active {
            background: var(--primary);
            color: white;
        }

        .menu-item i {
            font-size: 20px;
            width: 24px;
        }

        .badge {
            margin-left: auto;
            background: var(--danger);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .main-content {
            margin-left: 280px;
            padding: 30px;
            background: var(--dark-1);
        }

        /* Navbar */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 0 24px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
        }

        .page-title span {
            color: var(--text-secondary);
            font-size: 14px;
            margin-left: 8px;
        }

        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            background: var(--dark-2);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 16px 10px 40px;
            width: 300px;
            color: var(--text-primary);
        }

        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .maintenance-badge {
            background: var(--warning);
            color: black;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            background: var(--dark-2);
        }

        .user-menu:hover {
            background: var(--dark-3);
        }

        .user-avatar-small {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--dark-2);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .stat-trend {
            color: var(--success);
            font-size: 12px;
            margin-top: 8px;
        }

        /* Tables */
        .table-container {
            background: var(--dark-2);
            border-radius: 16px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .table-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            font-size: 18px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 16px 20px;
            background: var(--dark-3);
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 12px;
            text-transform: uppercase;
        }

        td {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
        }

        tr:hover {
            background: var(--dark-3);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .status-online {
            background: rgba(87, 242, 135, 0.2);
            color: var(--success);
        }

        .status-offline {
            background: rgba(237, 66, 69, 0.2);
            color: var(--danger);
        }

        .status-expired {
            background: rgba(254, 231, 92, 0.2);
            color: var(--warning);
        }

        .action-btn {
            background: var(--dark-3);
            border: none;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0 2px;
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Bot Cards */
        .bots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .bot-card {
            background: var(--dark-2);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .bot-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
        }

        .bot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .bot-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .bot-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 16px 0;
        }

        .bot-info-item {
            background: var(--dark-3);
            padding: 12px;
            border-radius: 8px;
        }

        .bot-info-label {
            color: var(--text-secondary);
            font-size: 11px;
            margin-bottom: 4px;
        }

        .bot-info-value {
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--dark-3);
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 4px;
            transition: width 0.3s;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark-2);
            border-radius: 20px;
            padding: 30px;
            width: 500px;
            max-width: 90%;
            border: 1px solid var(--border);
        }

        .modal-content.large {
            width: 800px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            margin-bottom: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        /* Logs */
        .logs-container {
            background: var(--dark-3);
            border-radius: 12px;
            padding: 20px;
            font-family: 'Monaco', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .log-line {
            padding: 4px 0;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .log-time {
            color: var(--primary);
            margin-right: 12px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 2px;
            background: var(--dark-3);
            padding: 4px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            flex: 1;
            text-align: center;
        }

        .tab:hover {
            background: var(--dark-4);
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1001;
        }

        .toast {
            background: var(--dark-2);
            border-left: 4px solid var(--success);
            border-radius: 8px;
            padding: 16px 24px;
            margin-top: 10px;
            color: var(--text-primary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: translateX(400px);
            transition: transform 0.3s;
            min-width: 300px;
            border: 1px solid var(--border);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--dark-3);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <div class="login-logo">
                <h1>üéÆ Bot Manager</h1>
                <p>G√©rez vos bots Discord</p>
            </div>
            
            <div id="loginStep1">
                <div class="login-form">
                    <div class="input-group">
                        <label>ID Discord</label>
                        <input type="text" id="userId" placeholder="Entrez votre ID Discord" value="123456789">
                    </div>
                    <button class="login-btn" onclick="loginWithToken()">
                        üîë Se connecter (Admin)
                    </button>
                    <div style="text-align: center; color: var(--text-secondary);">ou</div>
                    <button class="secondary-btn" onclick="showUserLogin()">
                        üë§ Connexion utilisateur
                    </button>
                </div>
            </div>

            <div id="loginStep2" style="display: none;">
                <div class="input-group">
                    <label>Token d'acc√®s</label>
                    <input type="password" id="accessToken" placeholder="Entrez le token admin">
                </div>
                <button class="login-btn" onclick="verifyToken()" style="margin-top: 20px;">
                    ‚úÖ Valider
                </button>
                <button class="secondary-btn" onclick="resetLogin()" style="margin-top: 10px;">
                    ‚Ü© Retour
                </button>
            </div>

            <div id="loginStep3" style="display: none;">
                <div class="code-display" id="userCode">38472915</div>
                <div class="timer" id="timer">Code valide 05:00</div>
                <div class="input-group" style="margin-top: 20px;">
                    <label>Code re√ßu en MP</label>
                    <input type="text" id="userCodeInput" placeholder="Code √† 8 chiffres" maxlength="8">
                </div>
                <button class="login-btn" onclick="verifyUserCode()" style="margin-top: 20px;">
                    ‚úÖ V√©rifier
                </button>
                <button class="secondary-btn" onclick="resetLogin()" style="margin-top: 10px;">
                    ‚Ü© Retour
                </button>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Bot Manager</h2>
            </div>

            <div class="user-info-sidebar" id="sidebarUser">
                <div class="user-avatar-large" id="sidebarAvatar">A</div>
                <div>
                    <div class="user-name" id="sidebarName">Admin</div>
                    <div><span class="status-badge status-online" id="sidebarRole">Admin</span></div>
                </div>
            </div>

            <div class="sidebar-menu">
                <div class="menu-category">Principal</div>
                <div class="menu-item active" onclick="changePage('dashboard')">
                    <i>üìä</i> Dashboard
                </div>
                <div class="menu-item" onclick="changePage('bots')">
                    <i>ü§ñ</i> Bots
                    <span class="badge" id="botsCount">0</span>
                </div>
                <div class="menu-item" onclick="changePage('users')">
                    <i>üë•</i> Utilisateurs
                </div>

                <div class="menu-category">Gestion</div>
                <div class="menu-item" onclick="changePage('models')">
                    <i>üì¶</i> Mod√®les
                </div>
                <div class="menu-item" onclick="changePage('maintenance')">
                    <i>üîß</i> Maintenance
                </div>
                <div class="menu-item" onclick="changePage('logs')">
                    <i>üìã</i> Logs
                </div>

                <div class="menu-category">Configuration</div>
                <div class="menu-item" onclick="changePage('settings')">
                    <i>‚öôÔ∏è</i> Param√®tres
                </div>
                <div class="menu-item" onclick="logout()">
                    <i>üö™</i> D√©connexion
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Navbar -->
            <div class="navbar">
                <div class="page-title" id="currentPageTitle">
                    Dashboard
                    <span>Aper√ßu g√©n√©ral</span>
                </div>
                
                <div class="navbar-actions">
                    <div class="search-box">
                        <i>üîç</i>
                        <input type="text" placeholder="Rechercher..." id="globalSearch">
                    </div>
                    
                    <div id="maintenanceBadge" style="display: none;" class="maintenance-badge">
                        <i>‚ö†Ô∏è</i> Mode maintenance
                    </div>

                    <div class="user-menu" onclick="toggleUserMenu()">
                        <div class="user-avatar-small" id="navAvatar">A</div>
                        <div>
                            <div id="navName">Admin</div>
                            <div style="font-size: 11px; color: var(--text-secondary);" id="navRole">Admin</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dynamic Content -->
            <div id="pageContent"></div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="addBotModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Ajouter un bot</h3>
                <button class="modal-close" onclick="closeModal('addBotModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Token Discord</label>
                    <input type="password" id="newBotToken" placeholder="Token du bot">
                </div>
                <div class="input-group">
                    <label>Propri√©taire (ID)</label>
                    <input type="text" id="newBotOwner" placeholder="ID Discord">
                </div>
                <div class="input-group">
                    <label>Mod√®le</label>
                    <select id="newBotModel">
                        <option value="">Chargement...</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Dur√©e</label>
                    <select id="newBotDuration">
                        <option value="14j">14 jours</option>
                        <option value="30j">30 jours</option>
                        <option value="1mois">1 mois</option>
                        <option value="3mois">3 mois</option>
                        <option value="6mois">6 mois</option>
                        <option value="1an">1 an</option>
                        <option value="99ans">99 ans</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Limite CPU (%)</label>
                    <input type="number" id="newBotCpu" value="25" min="5" max="100">
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="closeModal('addBotModal')">Annuler</button>
                <button class="login-btn" onclick="createBot()">Cr√©er le bot</button>
            </div>
        </div>
    </div>

    <div class="modal" id="botDetailsModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>ü§ñ D√©tails du bot</h3>
                <button class="modal-close" onclick="closeModal('botDetailsModal')">&times;</button>
            </div>
            <div class="modal-body" id="botDetailsContent"></div>
        </div>
    </div>

    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirmation</h3>
                <button class="modal-close" onclick="closeModal('confirmModal')">&times;</button>
            </div>
            <div class="modal-body" id="confirmMessage"></div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="closeModal('confirmModal')">Annuler</button>
                <button class="login-btn" onclick="executeConfirm()">Confirmer</button>
            </div>
        </div>
    </div>

    <div class="modal" id="maintenanceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîß Mode maintenance</h3>
                <button class="modal-close" onclick="closeModal('maintenanceModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>√âtat</label>
                    <select id="maintenanceState">
                        <option value="true">Activer</option>
                        <option value="false">D√©sactiver</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Message</label>
                    <input type="text" id="maintenanceMessage" placeholder="Message √† afficher">
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="closeModal('maintenanceModal')">Annuler</button>
                <button class="login-btn" onclick="setMaintenance()">Appliquer</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Configuration
        const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
            ? 'http://localhost:5000' 
            : 'https://votre-api.com'; // √Ä modifier avec votre URL

        let currentUser = {
            id: null,
            name: 'Admin',
            role: 'user',
            token: null
        };

        let bots = [];
        let models = [];
        let maintenanceMode = false;
        let codeTimer = null;
        let pendingAction = null;
        let stats = {
            total_bots: 0,
            online_bots: 0,
            offline_bots: 0,
            expired_bots: 0
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            checkSavedSession();
        });

        // Fonctions API
        async function apiCall(endpoint, method = 'GET', body = null) {
            const headers = {
                'Content-Type': 'application/json'
            };

            if (currentUser.token) {
                headers['Authorization'] = `Bearer ${currentUser.token}`;
            }

            const options = {
                method,
                headers
            };

            if (body) {
                options.body = JSON.stringify(body);
            }

            try {
                const response = await fetch(`${API_URL}${endpoint}`, options);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Erreur API');
                }
                
                return data;
            } catch (error) {
                showToast(error.message, 'error');
                throw error;
            }
        }

        // Authentification
        function loginWithToken() {
            document.getElementById('loginStep1').style.display = 'none';
            document.getElementById('loginStep2').style.display = 'block';
        }

        function showUserLogin() {
            document.getElementById('loginStep1').style.display = 'none';
            document.getElementById('loginStep3').style.display = 'block';
            startCodeTimer();
            
            // Simuler l'envoi d'un code (√† remplacer par appel API r√©el)
            const code = Math.floor(10000000 + Math.random() * 90000000);
            document.getElementById('userCode').textContent = code;
            showToast(`üì® Code envoy√© en MP: ${code}`, 'info');
        }

        function startCodeTimer() {
            let timeLeft = 300;
            const timer = document.getElementById('timer');
            
            if (codeTimer) clearInterval(codeTimer);
            
            codeTimer = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timer.textContent = `Code valide ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 60) {
                    timer.classList.add('warning');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(codeTimer);
                    timer.textContent = 'Code expir√©';
                }
                
                timeLeft--;
            }, 1000);
        }

        async function verifyToken() {
            const token = document.getElementById('accessToken').value;
            if (!token) {
                showToast('Entrez un token', 'error');
                return;
            }

            currentUser.token = token;
            currentUser.role = 'admin';
            currentUser.name = 'Administrateur';

            try {
                // V√©rifier la connexion
                const status = await apiCall('/api/status');
                maintenanceMode = status.maintenance || false;
                
                // Charger les donn√©es
                await loadInitialData();
                
                // Connecter
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('dashboard').style.display = 'grid';
                
                updateUserInfo();
                loadDashboard();
                
                localStorage.setItem('botManagerToken', token);
                showToast('‚úÖ Connect√© avec succ√®s');
                
            } catch (error) {
                showToast('Token invalide', 'error');
            }
        }

        async function verifyUserCode() {
            const code = document.getElementById('userCodeInput').value;
            const expectedCode = document.getElementById('userCode').textContent;
            
            if (code !== expectedCode) {
                showToast('Code incorrect', 'error');
                return;
            }

            // Mode utilisateur - utiliser un token limit√©
            currentUser.token = 'user_' + code;
            currentUser.role = 'user';
            currentUser.name = 'Utilisateur';
            
            try {
                await loadInitialData();
                
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('dashboard').style.display = 'grid';
                
                updateUserInfo();
                loadDashboard();
                
                showToast('‚úÖ Connect√© avec succ√®s');
                
            } catch (error) {
                showToast('Erreur de connexion', 'error');
            }
        }

        function resetLogin() {
            document.getElementById('loginStep1').style.display = 'block';
            document.getElementById('loginStep2').style.display = 'none';
            document.getElementById('loginStep3').style.display = 'none';
            if (codeTimer) clearInterval(codeTimer);
        }

        function checkSavedSession() {
            const savedToken = localStorage.getItem('botManagerToken');
            if (savedToken) {
                document.getElementById('accessToken').value = savedToken;
                verifyToken();
            }
        }

        function logout() {
            localStorage.removeItem('botManagerToken');
            currentUser.token = null;
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            resetLogin();
            showToast('D√©connect√©');
        }

        // Chargement des donn√©es
        async function loadInitialData() {
            try {
                const [botsData, modelsData, statsData] = await Promise.all([
                    apiCall('/api/bots'),
                    apiCall('/api/models'),
                    apiCall('/api/stats')
                ]);

                bots = botsData.data?.bots || [];
                models = modelsData.data || [];
                
                if (statsData.data) {
                    stats = statsData.data;
                }

                document.getElementById('botsCount').textContent = bots.length;
                
            } catch (error) {
                console.error('Erreur chargement:', error);
            }
        }

        function updateUserInfo() {
            const initial = currentUser.name.charAt(0);
            document.getElementById('sidebarAvatar').textContent = initial;
            document.getElementById('sidebarName').textContent = currentUser.name;
            document.getElementById('sidebarRole').textContent = 
                currentUser.role === 'admin' ? 'Admin' : 'Utilisateur';
            
            document.getElementById('navAvatar').textContent = initial;
            document.getElementById('navName').textContent = currentUser.name;
            document.getElementById('navRole').textContent = 
                currentUser.role === 'admin' ? 'Admin' : 'User';

            if (maintenanceMode) {
                document.getElementById('maintenanceBadge').style.display = 'flex';
            }
        }

        // Navigation
        function changePage(page) {
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            event.target.closest('.menu-item').classList.add('active');

            const titles = {
                'dashboard': 'Dashboard',
                'bots': 'Gestion des bots',
                'users': 'Utilisateurs',
                'models': 'Mod√®les',
                'maintenance': 'Maintenance',
                'logs': 'Logs syst√®me',
                'settings': 'Param√®tres'
            };

            document.getElementById('currentPageTitle').innerHTML = 
                `${titles[page]} <span>${getPageSubtitle(page)}</span>`;

            switch(page) {
                case 'dashboard': loadDashboard(); break;
                case 'bots': loadBotsPage(); break;
                case 'users': loadUsersPage(); break;
                case 'models': loadModelsPage(); break;
                case 'maintenance': loadMaintenancePage(); break;
                case 'logs': loadLogsPage(); break;
                case 'settings': loadSettingsPage(); break;
            }
        }

        function getPageSubtitle(page) {
            const subtitles = {
                'dashboard': 'Aper√ßu g√©n√©ral',
                'bots': `${bots.length} bot(s) au total`,
                'users': 'Gestion des utilisateurs',
                'models': `${models.length} mod√®le(s) disponible(s)`,
                'maintenance': 'Mode maintenance',
                'logs': 'Historique des √©v√©nements',
                'settings': 'Configuration'
            };
            return subtitles[page] || '';
        }

        // Pages
        async function loadDashboard() {
            try {
                const statsData = await apiCall('/api/stats');
                stats = statsData.data;

                const content = document.getElementById('pageContent');
                content.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon">ü§ñ</div>
                            </div>
                            <div class="stat-value">${stats.total_bots || 0}</div>
                            <div class="stat-label">Bots totaux</div>
                            <div class="stat-trend">${stats.online_bots || 0} en ligne</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon">üü¢</div>
                            </div>
                            <div class="stat-value">${stats.online_bots || 0}</div>
                            <div class="stat-label">Bots en ligne</div>
                            <div class="stat-trend">${Math.round((stats.online_bots / stats.total_bots) * 100 || 0)}% actifs</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon">‚öôÔ∏è</div>
                            </div>
                            <div class="stat-value">${stats.avg_cpu || 0}%</div>
                            <div class="stat-label">CPU moyenne</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon">üì¶</div>
                            </div>
                            <div class="stat-value">${models.length}</div>
                            <div class="stat-label">Mod√®les</div>
                        </div>
                    </div>

                    <div class="table-container" style="margin-top: 30px;">
                        <div class="table-header">
                            <h3>Bots r√©cents</h3>
                            <button class="secondary-btn" onclick="changePage('bots')">Voir tout</button>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Mod√®le</th>
                                    <th>Propri√©taire</th>
                                    <th>Statut</th>
                                    <th>CPU</th>
                                    <th>Expiration</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${bots.slice(0, 5).map(bot => `
                                    <tr>
                                        <td><code>${bot.instance_id?.substring(0, 8)}...</code></td>
                                        <td>${bot.model_name || 'N/A'}</td>
                                        <td>${bot.owner_name || bot.owner_id}</td>
                                        <td><span class="status-badge status-${bot.current_status || bot.status}">${bot.current_status || bot.status}</span></td>
                                        <td>${bot.cpu_limit || 25}%</td>
                                        <td><t:${bot.expires_at}:R></td>
                                        <td>
                                            <button class="action-btn" onclick="viewBotDetails('${bot.instance_id}')">üëÅÔ∏è</button>
                                            <button class="action-btn" onclick="controlBot('${bot.instance_id}', 'restart')">üîÑ</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div class="stat-card">
                            <h3>R√©partition par mod√®le</h3>
                            <div style="margin-top: 15px;">
                                ${Object.entries(stats.models_distribution || {}).map(([model, count]) => `
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span>${model}</span>
                                        <span>${count} bots</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <h3>√âtat syst√®me</h3>
                            <div style="margin-top: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Mode maintenance</span>
                                    <span class="status-badge ${maintenanceMode ? 'status-online' : 'status-offline'}">
                                        ${maintenanceMode ? 'Actif' : 'Inactif'}
                                    </span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Version API</span>
                                    <span>1.0.0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                showToast('Erreur chargement dashboard', 'error');
            }
        }

        async function loadBotsPage() {
            try {
                const botsData = await apiCall('/api/bots');
                bots = botsData.data?.bots || [];

                const content = document.getElementById('pageContent');
                content.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>Gestion des bots</h2>
                        ${currentUser.role === 'admin' ? `
                            <button class="login-btn" onclick="showAddBotModal()">
                                <i>‚ûï</i> Ajouter un bot
                            </button>
                        ` : ''}
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <h3>Liste des bots</h3>
                            <div class="table-actions">
                                <button class="secondary-btn" onclick="refreshBots()">üîÑ Rafra√Æchir</button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Mod√®le</th>
                                    <th>Propri√©taire</th>
                                    <th>Statut</th>
                                    <th>CPU</th>
                                    <th>Expiration</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${bots.map(bot => `
                                    <tr>
                                        <td><code>${bot.instance_id}</code></td>
                                        <td>${bot.model_name}</td>
                                        <td>${bot.owner_name || bot.owner_id}</td>
                                        <td>
                                            <span class="status-badge status-${bot.current_status || bot.status}">
                                                ${bot.current_status || bot.status}
                                            </span>
                                        </td>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <span>${bot.cpu_limit || 25}%</span>
                                                ${currentUser.role === 'admin' ? `
                                                    <button class="action-btn" onclick="editCpu('${bot.instance_id}')">‚úèÔ∏è</button>
                                                ` : ''}
                                            </div>
                                        </td>
                                        <td><t:${bot.expires_at}:R></td>
                                        <td>
                                            <button class="action-btn" onclick="viewBotDetails('${bot.instance_id}')">üëÅÔ∏è</button>
                                            <button class="action-btn" onclick="controlBot('${bot.instance_id}', 'restart')">üîÑ</button>
                                            <button class="action-btn" onclick="controlBot('${bot.instance_id}', 'stop')">‚èπÔ∏è</button>
                                            <button class="action-btn" onclick="controlBot('${bot.instance_id}', 'start')">‚ñ∂Ô∏è</button>
                                            ${currentUser.role === 'admin' ? `
                                                <button class="action-btn" onclick="deleteBot('${bot.instance_id}')">üóëÔ∏è</button>
                                            ` : ''}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                showToast('Erreur chargement bots', 'error');
            }
        }

        async function loadUsersPage() {
            if (currentUser.role !== 'admin') {
                showToast('Acc√®s r√©serv√© aux administrateurs', 'error');
                return;
            }

            const content = document.getElementById('pageContent');
            content.innerHTML = `
                <h2>Gestion des utilisateurs</h2>
                
                <div style="margin: 20px 0;">
                    <input type="text" class="search-box" style="width: 100%;" 
                           placeholder="Rechercher un utilisateur par ID...">
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID Utilisateur</th>
                                <th>Bots</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Array.from(new Set(bots.map(b => b.owner_id))).map(userId => {
                                const userBots = bots.filter(b => b.owner_id === userId);
                                return `
                                    <tr>
                                        <td><code>${userId}</code></td>
                                        <td>${userBots.length} bot(s)</td>
                                        <td>
                                            <button class="action-btn" onclick="viewUserBots('${userId}')">üëÅÔ∏è</button>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        async function loadModelsPage() {
            try {
                const modelsData = await apiCall('/api/models');
                models = modelsData.data || [];

                const content = document.getElementById('pageContent');
                content.innerHTML = `
                    <h2>Mod√®les disponibles</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                        ${models.map(model => `
                            <div class="stat-card">
                                <h3>üìÅ ${model}</h3>
                                <p style="color: var(--text-secondary); margin: 10px 0;">
                                    Mod√®le de bot Discord
                                </p>
                                <button class="secondary-btn" style="width: 100%;" 
                                        onclick="showAddBotModal('${model}')">
                                    Utiliser ce mod√®le
                                </button>
                            </div>
                        `).join('')}
                    </div>
                `;
            } catch (error) {
                showToast('Erreur chargement mod√®les', 'error');
            }
        }

        function loadMaintenancePage() {
            if (currentUser.role !== 'admin') {
                showToast('Acc√®s r√©serv√© aux administrateurs', 'error');
                return;
            }

            const content = document.getElementById('pageContent');
            content.innerHTML = `
                <h2>Mode maintenance</h2>
                
                <div class="settings-group" style="margin-top: 20px;">
                    <div class="settings-row">
                        <span>√âtat actuel</span>
                        <span class="status-badge ${maintenanceMode ? 'status-online' : 'status-offline'}">
                            ${maintenanceMode ? 'Actif' : 'Inactif'}
                        </span>
                    </div>
                    
                    <button class="login-btn" onclick="showMaintenanceModal()" style="margin-top: 20px;">
                        Configurer la maintenance
                    </button>
                </div>

                <div style="margin-top: 30px;">
                    <h3>Statut des bots</h3>
                    <div class="stats-grid" style="margin-top: 15px;">
                        <div class="stat-card">
                            <div class="stat-value">${stats.online_bots || 0}</div>
                            <div class="stat-label">Bots en ligne</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.offline_bots || 0}</div>
                            <div class="stat-label">Bots hors ligne</div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadLogsPage() {
            const content = document.getElementById('pageContent');
            content.innerHTML = `
                <h2>Logs syst√®me</h2>
                
                <div class="logs-container" style="margin-top: 20px; height: 500px;">
                    <div class="log-line">
                        <span class="log-time">[${new Date().toLocaleTimeString()}]</span>
                        Syst√®me d√©marr√©
                    </div>
                    ${bots.map(bot => `
                        <div class="log-line">
                            <span class="log-time">[${new Date().toLocaleTimeString()}]</span>
                            Bot ${bot.instance_id} - ${bot.status}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function loadSettingsPage() {
            const content = document.getElementById('pageContent');
            content.innerHTML = `
                <h2>Param√®tres</h2>
                
                <div class="settings-group" style="margin-top: 20px;">
                    <h3>Informations</h3>
                    <div style="margin-top: 15px;">
                        <div class="info-row" style="margin-bottom: 10px;">
                            <span class="info-label">Utilisateur:</span>
                            <span>${currentUser.name}</span>
                        </div>
                        <div class="info-row" style="margin-bottom: 10px;">
                            <span class="info-label">R√¥le:</span>
                            <span>${currentUser.role}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">API URL:</span>
                            <span>${API_URL}</span>
                        </div>
                    </div>
                    
                    <button class="secondary-btn" onclick="logout()" style="margin-top: 20px;">
                        D√©connexion
                    </button>
                </div>
            `;
        }

        // Actions sur les bots
        async function controlBot(botId, action) {
            try {
                const result = await apiCall(`/api/bots/${botId}/${action}`, 'POST');
                showToast(`‚úÖ Bot ${action} avec succ√®s`);
                refreshBots();
            } catch (error) {
                showToast(`Erreur: ${error.message}`, 'error');
            }
        }

        async function viewBotDetails(botId) {
            try {
                const botData = await apiCall(`/api/bots/${botId}`);
                const bot = botData.data;

                const content = document.getElementById('botDetailsContent');
                content.innerHTML = `
                    <div class="bot-info-grid">
                        <div class="bot-info-item">
                            <div class="bot-info-label">ID</div>
                            <div class="bot-info-value"><code>${bot.instance_id}</code></div>
                        </div>
                        <div class="bot-info-item">
                            <div class="bot-info-label">Mod√®le</div>
                            <div class="bot-info-value">${bot.model_name}</div>
                        </div>
                        <div class="bot-info-item">
                            <div class="bot-info-label">Statut</div>
                            <div class="bot-info-value">
                                <span class="status-badge status-${bot.current_status || bot.status}">
                                    ${bot.current_status || bot.status}
                                </span>
                            </div>
                        </div>
                        <div class="bot-info-item">
                            <div class="bot-info-label">CPU</div>
                            <div class="bot-info-value">${bot.cpu_limit || 25}%</div>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4>Propri√©taire</h4>
                        <p><code>${bot.owner_id}</code> (${bot.owner_name})</p>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4>Expiration</h4>
                        <p><t:${bot.expires_at}:F> (<t:${bot.expires_at}:R>)</p>
                    </div>

                    ${bot.last_error ? `
                        <div style="margin-top: 20px;">
                            <h4 style="color: var(--danger);">Derni√®re erreur</h4>
                            <pre style="background: var(--dark-3); padding: 15px; border-radius: 8px;">${bot.last_error}</pre>
                        </div>
                    ` : ''}

                    <div style="margin-top: 20px;">
                        <h4>Actions</h4>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="action-btn" onclick="controlBot('${bot.instance_id}', 'start')">‚ñ∂Ô∏è D√©marrer</button>
                            <button class="action-btn" onclick="controlBot('${bot.instance_id}', 'stop')">‚èπÔ∏è Arr√™ter</button>
                            <button class="action-btn" onclick="controlBot('${bot.instance_id}', 'restart')">üîÑ Red√©marrer</button>
                        </div>
                    </div>
                `;

                showModal('botDetailsModal');
            } catch (error) {
                showToast('Erreur chargement d√©tails', 'error');
            }
        }

        async function showAddBotModal(preSelectedModel = null) {
            try {
                const modelsData = await apiCall('/api/models');
                models = modelsData.data || [];

                const select = document.getElementById('newBotModel');
                select.innerHTML = models.map(m => 
                    `<option value="${m}" ${m === preSelectedModel ? 'selected' : ''}>${m}</option>`
                ).join('');

                showModal('addBotModal');
            } catch (error) {
                showToast('Erreur chargement mod√®les', 'error');
            }
        }

        async function createBot() {
            const botData = {
                token: document.getElementById('newBotToken').value,
                owner_id: document.getElementById('newBotOwner').value,
                model: document.getElementById('newBotModel').value,
                duration: document.getElementById('newBotDuration').value,
                cpu_limit: parseInt(document.getElementById('newBotCpu').value)
            };

            if (!botData.token || !botData.owner_id || !botData.model) {
                showToast('Tous les champs sont requis', 'error');
                return;
            }

            try {
                const result = await apiCall('/api/bots', 'POST', botData);
                if (result.success) {
                    showToast('‚úÖ Bot cr√©√© avec succ√®s');
                    closeModal('addBotModal');
                    refreshBots();
                }
            } catch (error) {
                showToast(`Erreur: ${error.message}`, 'error');
            }
        }

        async function deleteBot(botId) {
            pendingAction = async () => {
                try {
                    await apiCall(`/api/bots/${botId}`, 'DELETE');
                    showToast('‚úÖ Bot supprim√©');
                    refreshBots();
                } catch (error) {
                    showToast(`Erreur: ${error.message}`, 'error');
                }
            };
            
            document.getElementById('confirmMessage').innerHTML = 
                `√ätes-vous s√ªr de vouloir supprimer le bot <code>${botId}</code> ?<br><br>Cette action est irr√©versible.`;
            showModal('confirmModal');
        }

        async function editCpu(botId) {
            const newCpu = prompt('Nouvelle limite CPU (5-100%) :', '25');
            if (!newCpu) return;

            try {
                await apiCall(`/api/bots/${botId}`, 'PUT', { cpu_limit: parseInt(newCpu) });
                showToast('‚úÖ Limite CPU modifi√©e');
                refreshBots();
            } catch (error) {
                showToast(`Erreur: ${error.message}`, 'error');
            }
        }

        // Maintenance
        function showMaintenanceModal() {
            document.getElementById('maintenanceState').value = maintenanceMode ? 'false' : 'true';
            showModal('maintenanceModal');
        }

        async function setMaintenance() {
            const enabled = document.getElementById('maintenanceState').value === 'true';
            const message = document.getElementById('maintenanceMessage').value;

            try {
                await apiCall('/api/maintenance', 'POST', {
                    enabled,
                    message: message || undefined
                });
                
                maintenanceMode = enabled;
                showToast(`‚úÖ Mode maintenance ${enabled ? 'activ√©' : 'd√©sactiv√©'}`);
                closeModal('maintenanceModal');
                
                if (enabled) {
                    document.getElementById('maintenanceBadge').style.display = 'flex';
                } else {
                    document.getElementById('maintenanceBadge').style.display = 'none';
                }
            } catch (error) {
                showToast(`Erreur: ${error.message}`, 'error');
            }
        }

        // Utilitaires
        async function refreshBots() {
            await loadInitialData();
            if (document.getElementById('currentPageTitle').textContent.includes('Bots')) {
                loadBotsPage();
            } else {
                loadDashboard();
            }
        }

        function viewUserBots(userId) {
            changePage('bots');
            document.getElementById('globalSearch').value = userId;
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function executeConfirm() {
            if (pendingAction) {
                pendingAction();
                pendingAction = null;
            }
            closeModal('confirmModal');
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div>${message}</div>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    container.removeChild(toast);
                }, 300);
            }, 3000);
        }

        function toggleUserMenu() {
            // Menu utilisateur (d√©connexion)
            showConfirm('Se d√©connecter ?', logout);
        }

        function showConfirm(message, callback) {
            document.getElementById('confirmMessage').innerHTML = message;
            pendingAction = callback;
            showModal('confirmModal');
        }

        // Recherche globale
        document.getElementById('globalSearch')?.addEventListener('input', (e) => {
            const search = e.target.value.toLowerCase();
            // Impl√©menter la recherche
        });

        // Rafra√Æchissement automatique
        setInterval(() => {
            if (currentUser.token) {
                refreshBots();
            }
        }, 30000);
    </script>
</body>
</html>